
<div class="container mx-auto p-8">
  <div class="bg-gray-800 shadow-lg rounded-xl overflow-hidden p-6 border border-gray-600">
    <h2 class="text-2xl font-bold text-white mb-4">Gestion des Rendez-vous</h2>
    <p class="text-gray-300 text-sm mb-6">Visualisez, recherchez et modifiez les rendez-vous de visite véhicule.</p>

    <!-- Contrôles de recherche -->
    <div class="flex flex-wrap justify-start gap-4 mb-6">
      <!-- Recherche par client -->
      <div class="w-full sm:w-1/4 md:w-1/5">
        <div class="relative">
          <input [(ngModel)]="searchClient" type="text"
                 class="w-full py-2 px-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-white transition duration-200 ease-in-out"
                 placeholder="Client">
          <span class="absolute right-3 top-2 text-gray-400"><i class="fa fa-user"></i></span>
        </div>
      </div>

      <!-- Recherche par véhicule -->
      <div class="w-full sm:w-1/4 md:w-1/5">
        <div class="relative">
          <input [(ngModel)]="searchVehicule" type="text"
                 class="w-full py-2 px-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-white transition duration-200 ease-in-out"
                 placeholder="Véhicule">
          <span class="absolute right-3 top-2 text-gray-400"><i class="fa fa-car"></i></span>
        </div>
      </div>

      <!-- Recherche par commercial -->
      <div class="w-full sm:w-1/4 md:w-1/5">
        <div class="relative">
          <input [(ngModel)]="searchCommercial" type="text"
                 class="w-full py-2 px-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-white transition duration-200 ease-in-out"
                 placeholder="Commercial">
          <span class="absolute right-3 top-2 text-gray-400"><i class="fa fa-briefcase"></i></span>
        </div>
      </div>



      <!-- Filtrer par date (plage de début et fin) -->
      <div class="flex space-x-2 w-full sm:w-auto md:w-auto">
        <div class="flex-1 max-w-[170px]">
          <input
            type="date"
            [(ngModel)]="startDate"
            (change)="onFilterChange()"
            class="w-full py-2 px-3 border border-gray-600 bg-gray-700 text-white rounded-lg"
            placeholder="Date début"
          />
        </div>
        <div class="flex-1 max-w-[170px]">
          <input
            type="date"
            [(ngModel)]="endDate"
            (change)="onFilterChange()"
            class="w-full py-2 px-3 border border-gray-600 bg-gray-700 text-white rounded-lg"
            placeholder="Date fin"
          />
        </div>
      </div>

    </div>




    <!-- Tableau des rendez-vous -->
    <table class="table-auto w-full border-collapse border border-gray-600 text-white">
      <thead>
      <tr class="bg-gray-700">
        <th class="border border-gray-600 px-4 py-2 text-left">Date</th>
        <th class="border border-gray-600 px-4 py-2 text-left">Heure</th>
        <th class="border border-gray-600 px-4 py-2 text-left">Client</th>
        <th class="border border-gray-600 px-4 py-2 text-left">ShowRoom</th>
        <th class="border border-gray-600 px-4 py-2 text-left">Véhicule</th>
        <th class="border border-gray-600 px-4 py-2 text-left">Commercial</th>
        <th class="border border-gray-600 px-4 py-2 text-left">Statut</th>
        <th class="border border-gray-600 px-4 py-2 text-center">Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let rdv of filteredRendezVousList" class="hover:bg-gray-700">
        <td class="border border-gray-600 px-4 py-2">{{ rdv.date }}</td>
        <td class="border border-gray-600 px-4 py-2">{{ rdv.heure }}</td>
        <td class="border border-gray-600 px-4 py-2">{{ rdv.clientFullName }}</td>
        <td class="border border-gray-600 px-4 py-2">{{ rdv.magasinNom }}</td>
        <td class="border border-gray-600 px-4 py-2">{{ rdv.vehiculeMakeModel}}</td>
        <td class="border border-gray-600 px-4 py-2">{{ rdv.commercialFullName || '-' }}</td>
        <td class="border border-gray-600 px-4 py-2">
  <span
    [ngClass]="{
      'bg-green-600 text-white': rdv.statut === 'VALIDE',
      'bg-red-600 text-white': rdv.statut === 'REFUSE',
      'bg-yellow-500 text-black': rdv.statut === 'EN_ATTENTE',
      'bg-gray-500 text-white': rdv.statut === 'TERMINE'
    }"
    class="px-3 py-1 rounded-full text-sm font-semibold"
  >
    {{ rdv.statut.toLowerCase().replace('_', ' ') }}
  </span>
        </td>

        <td class="border border-gray-600 px-4 py-2 text-center space-x-2">
          <!-- Modifier -->
          <button
            *ngIf="rdv.statut === 'EN_ATTENTE'"
            (click)="editRdv(rdv)"
            class="text-blue-500 hover:text-blue-700 transition"
            title="Modifier"
          >
            <i class="fas fa-edit"></i>
          </button>

          <!-- Valider -->
          <button
            *ngIf="rdv.statut === 'EN_ATTENTE'"
            (click)="validerRdv(rdv)"
            class="text-green-500 hover:text-green-700 transition"
            title="Valider"
          >
            <i class="fas fa-check-circle"></i>
          </button>

          <!-- Refuser -->
          <button
            *ngIf="rdv.statut === 'EN_ATTENTE'"
            (click)="refuserRdv(rdv)"
            class="text-red-500 hover:text-red-700 transition"
            title="Refuser"
          >
            <i class="fas fa-times-circle"></i>
          </button>
        </td>

      </tr>
      </tbody>
    </table>
  </div>

  <!-- Panel latéral modification -->
  <div
    *ngIf="showEditPanel"
    class="fixed inset-0 z-50 flex justify-end bg-gray-800 bg-opacity-70"
  >
    <div
      class="bg-white w-96 h-full shadow-lg rounded-l-2xl p-8 overflow-y-auto relative"
    >
      <button
        (click)="cancelEdit()"
        class="absolute top-6 left-6 text-gray-600 hover:text-gray-700 text-2xl font-semibold transition-all duration-300"
        aria-label="Fermer le panneau de modification"
      >
        ✖
      </button>

      <h3 class="text-2xl font-semibold mb-6 text-gray-800 text-center">
        Modifier le rendez-vous
      </h3>

      <form (ngSubmit)="saveRdv()" class="space-y-4">
        <div>
          <label class="block text-gray-700 font-medium mb-1" for="commercialId">Commercial :</label>
          <select
            id="commercialId"
            [(ngModel)]="selectedRdv!.commercialId"
            name="commercialId"
            class="w-full border border-gray-400 rounded px-3 py-2"
          >
            <option [ngValue]="null" disabled>-- Sélectionner un commercial --</option>
            <option *ngFor="let commercial of users" [ngValue]="commercial.id">
              {{ commercial.nomComplet }}
            </option>
          </select>
        </div>
        <div>
          <label class="block text-gray-700 font-medium mb-1" for="magasinId">Magasin :</label>
          <select
            id="magasinId"
            [(ngModel)]="selectedRdv!.magasinId"
            name="magasinId"
            class="w-full border border-gray-400 rounded px-3 py-2"
          >
            <option [ngValue]="null" disabled>-- Sélectionner un magasin --</option>
            <option *ngFor="let magasin of magasins" [ngValue]="magasin.id">
              {{ magasin.nom }}
            </option>
          </select>
        </div>



        <div class="flex justify-end space-x-4 mt-6">
          <button
            type="button"
            (click)="cancelEdit()"
            class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 transition"
          >
            Annuler
          </button>
          <button
            type="submit"
            class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition"
          >
            Enregistrer
          </button>
        </div>
      </form>

    </div>
  </div>

</div>
